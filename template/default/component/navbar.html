{{define "navbar"}}
<body class="bg-white flex flex-col min-h-screen">
    <!-- Navigation Bar -->
    <nav class="bg-white border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex">
                    <div class="flex-shrink-0 flex items-center">
                        <a href="/" class="flex items-center text-blue-600">
                            <i class="fas fa-code text-xl mr-2"></i>
                            <span class="font-bold text-xl text-gray-700">My Blog</span>
                        </a>
                    </div>
                    <div class="hidden sm:ml-6 sm:flex sm:space-x-8">
                        <a href="/" class="nav-link border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium">Home</a>
                        <a href="/post/list" class="nav-link border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium">Posts</a>
                        <!-- <a href="/teaching" class="nav-link border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium">Teachings</a> -->
                        <a href="/archive" class="nav-link border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium">Archive</a>
                        <a href="/download/index" class="nav-link border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium">Download</a>
                    </div>
                </div>
                <div class="flex items-center px-2">
                    <div class="flex-shrink-0 sm:block hidden">
                        <div class="relative">
                            <input type="text" 
                                id="nav-search"
                                class="block w-full pl-10 pr-8 py-2 border border-gray-300 rounded-md leading-5 bg-white 
                                    placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 
                                    focus:ring-1 focus:ring-gray-400 focus:border-gray-400 
                                    hover:border-gray-400 transition-colors duration-200
                                    sm:text-sm" 
                                placeholder="Search">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <i class="fas fa-search text-gray-400"></i>
                            </div>
                            <div class="absolute inset-y-0 right-0 pr-3 flex items-center cursor-pointer hidden" id="nav-search-clear">
                                <i class="fas fa-times text-gray-400 hover:text-gray-600"></i>
                            </div>
                        </div>
                    </div>
                    <div class="hidden sm:ml-6 sm:flex sm:items-center">
                        <a href="/register" class="ml-4 inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">Register</a>
                        <a href="/login" class="ml-4 inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">Sign in</a>
                    </div>
                </div>
                <!-- Mobile menu button -->
                <div class="flex items-center sm:hidden">
                    <button type="button" class="mobile-menu-button inline-flex items-center justify-center rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100 " aria-controls="mobile-menu" aria-expanded="false">
                        <span class="sr-only">Open main menu</span>
                        <i class="fas fa-bars block h-6 w-6 "></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Mobile menu, show/hide based on menu state -->
        <div class="sm:hidden hidden" id="mobile-menu">
            <!-- Add mobile search box -->
            <div class="px-4 pt-4 pb-4 mx-4">
                <div class="relative">
                    <input type="text" 
                        id="mobile-nav-search"
                        class="block w-full pl-10 pr-8 py-2 border border-gray-300 rounded-md leading-5 bg-white 
                            placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 
                            focus:ring-1 focus:ring-gray-400 focus:border-gray-400
                            hover:border-gray-400 transition-colors duration-200
                            sm:text-sm" 
                        placeholder="Search">
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <i class="fas fa-search text-gray-400"></i>
                    </div>
                    <div class="absolute inset-y-0 right-0 pr-3 flex items-center cursor-pointer hidden" id="mobile-nav-search-clear">
                        <i class="fas fa-times text-gray-400 hover:text-gray-600"></i>
                    </div>
                </div>
            </div>
            <div class="pt-2 pb-3 space-y-1">
                <a href="/" class="nav-link-mobile block pl-3 pr-4 py-2 border-l-4 text-base font-medium border-transparent text-gray-500 hover:bg-gray-50 hover:border-gray-300 hover:text-gray-700">Home</a>
                <a href="/post/list" class="nav-link-mobile block pl-3 pr-4 py-2 border-l-4 text-base font-medium border-transparent text-gray-500 hover:bg-gray-50 hover:border-gray-300 hover:text-gray-700">Posts</a>
                <!-- <a href="/teaching" class="nav-link-mobile block pl-3 pr-4 py-2 border-l-4 text-base font-medium border-transparent text-gray-500 hover:bg-gray-50 hover:border-gray-300 hover:text-gray-700">Teachings</a> -->
                <a href="/archive" class="nav-link-mobile block pl-3 pr-4 py-2 border-l-4 text-base font-medium border-transparent text-gray-500 hover:bg-gray-50 hover:border-gray-300 hover:text-gray-700">Archive</a>
                <a href="/download/index" class="nav-link-mobile block pl-3 pr-4 py-2 border-l-4 text-base font-medium border-transparent text-gray-500 hover:bg-gray-50 hover:border-gray-300 hover:text-gray-700">Download</a>
            </div>
            <div class="pt-4 pb-3 border-t border-gray-200">
                <div class="space-y-1">
                    <a href="/register" class="block px-4 py-2 text-base font-medium text-gray-500 hover:text-gray-800 hover:bg-gray-100">Register</a>
                    <a href="/login" class="block px-4 py-2 text-base font-medium text-gray-500 hover:text-gray-800 hover:bg-gray-100">Sign in</a>
                </div>
            </div>
        </div>
    </nav>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const navSearch = document.getElementById('nav-search');
            const mobileNavSearch = document.getElementById('mobile-nav-search');

            // Sync search box with URL
            function syncSearchWithURL(searchInput) {
                const keyword = searchInput.value.trim();
                const currentUrl = new URL(window.location.href);
                if (keyword) {
                    currentUrl.searchParams.set('keyword', keyword);
                } else {
                    currentUrl.searchParams.delete('keyword');
                }
                window.history.replaceState({}, '', currentUrl);
            }

            // Handle search box input events
            navSearch.addEventListener('input', () => {
                mobileNavSearch.value = navSearch.value;
                syncSearchWithURL(navSearch);
                toggleClearButton(navSearch, 'nav-search-clear');
                toggleClearButton(mobileNavSearch, 'mobile-nav-search-clear');
            });

            mobileNavSearch.addEventListener('input', () => {
                navSearch.value = mobileNavSearch.value;
                syncSearchWithURL(mobileNavSearch);
                toggleClearButton(navSearch, 'nav-search-clear');
                toggleClearButton(mobileNavSearch, 'mobile-nav-search-clear');
            });

            // Initial sync with URL
            const urlParams = new URLSearchParams(window.location.search);
            const searchValue = urlParams.get('keyword');
            if (searchValue) {
                navSearch.value = searchValue;
                mobileNavSearch.value = searchValue;
                toggleClearButton(navSearch, 'nav-search-clear');
                toggleClearButton(mobileNavSearch, 'mobile-nav-search-clear');
            }

            // Navigation highlight code
            const currentPath = window.location.pathname;
            const navLinks = document.querySelectorAll('.nav-link, .nav-link-mobile');
            
            navLinks.forEach(link => {
                if (link.getAttribute('href') === currentPath) {
                    if (link.classList.contains('nav-link')) {
                        link.classList.remove('border-transparent', 'text-gray-500', 'hover:border-gray-300', 'hover:text-gray-700');
                        link.classList.add('border-blue-600', 'text-gray-900');
                    } else {
                        // Mobile menu highlight style
                        link.classList.remove('border-transparent', 'text-gray-500');
                        link.classList.add('border-blue-600', 'text-gray-900', 'bg-blue-50');
                    }
                }
            });

            // Mobile menu toggle
            const mobileMenuButton = document.querySelector('.mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');

            mobileMenuButton.addEventListener('click', () => {
                const isHidden = mobileMenu.classList.contains('hidden');
                if (isHidden) {
                    mobileMenu.classList.remove('hidden');
                } else {
                    mobileMenu.classList.add('hidden');
                }
            });

            // Toggle clear button visibility
            function toggleClearButton(searchInput, clearButtonId) {
                const clearButton = document.getElementById(clearButtonId);
                if (searchInput.value) {
                    clearButton.classList.remove('hidden');
                } else {
                    clearButton.classList.add('hidden');
                }
            }

            // Setup clear button functionality
            document.getElementById('nav-search-clear').addEventListener('click', () => {
                navSearch.value = '';
                mobileNavSearch.value = '';
                toggleClearButton(navSearch, 'nav-search-clear');
                toggleClearButton(mobileNavSearch, 'mobile-nav-search-clear');
                syncSearchWithURL(navSearch);
                navSearch.focus();
            });

            document.getElementById('mobile-nav-search-clear').addEventListener('click', () => {
                navSearch.value = '';
                mobileNavSearch.value = '';
                toggleClearButton(navSearch, 'nav-search-clear');
                toggleClearButton(mobileNavSearch, 'mobile-nav-search-clear');
                syncSearchWithURL(mobileNavSearch);
                mobileNavSearch.focus();
            });

            // Handle search box enter event
            function handleSearch(event) {
                if (event.key === 'Enter') {
                    const keyword = event.target.value.trim();
                    if (keyword) {
                        window.location.href = `/post/list?keyword=${encodeURIComponent(keyword)}`;
                    }
                }
            }

            navSearch.addEventListener('keyup', handleSearch);
            mobileNavSearch.addEventListener('keyup', handleSearch);
        });
    </script>
</body>
{{end}}